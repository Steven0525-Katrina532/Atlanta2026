<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Login</title>`r`n  <link rel="stylesheet" href="/styles/tokens.css">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
  /* NORA branding */
  body{margin:0;background:var(--nora-teal);min-height:100vh;display:flex;flex-direction:column;font-family:system-ui,Segoe UI,Roboto,Arial}
  .nora-top{position:sticky;top:0;left:0;right:0;background:var(--nora-black);color:var(--nora-white);height:64px;display:flex;align-items:center;padding:0 16px;z-index:100}
  .nora-top img{height:40px;width:auto;display:block}
  .page{flex:1;display:grid;place-items:center;padding:24px}
  .card{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:320px;max-width:92vw;padding:20px}
  h1{margin:0 0 12px 0;font-size:20px}
  label{display:block;font-size:12px;margin-top:10px;color:#333}
  input{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;margin-top:6px}
  button{width:100%;margin-top:16px;padding:10px;border:0;border-radius:10px;background:#1f8a5b;color:#fff;font-weight:600;cursor:pointer}
  button:hover{filter:brightness(1.05)}
  .err{color:#7a0f0f;background:#fdecec;border-radius:8px;padding:8px;margin-top:10px;display:none}
</style>
</head>
<body>
  <div class='nora-top'>
    <img src='/img/nora-logo.png' alt='NORA'>
  </div>
  <div class='page'>
<div class='nora-top'>
    <img src='/img/nora-logo.png' alt='NORA'>
  </div>
  <div class='page'>
<div class="card">
    <h1>Sign in</h1>
    <label>Email</label>
    <input id="email" type="email" autocomplete="username" />
    <label>Password</label>
    <input id="password" type="password" autocomplete="current-password" />
    <button id="loginBtn" type="button">Sign in</button>
    <div id="err" class="err"></div>
  </div>

  <script>
    // Hard kill any old service worker that may be serving stale JS/HTML
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(rs => rs.forEach(r => r.unregister()));
    }
  </script>

  <script type="module" id="login-next-guard">
    import { auth } from "/js/app-init.js";
    import { onAuthStateChanged, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";

    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const btn = document.getElementById("loginBtn");
    const err = document.getElementById("err");

    function showError(msg) {
      err.textContent = msg || "Sign-in failed";
      err.style.display = "block";
    }

    btn.addEventListener("click", async () => {
      err.style.display = "none";
      try {
        await signInWithEmailAndPassword(auth, String(email.value||""), String(password.value||""));
        // Redirect handled by onAuthStateChanged below.
      } catch(e) {
        showError(e?.message || "Error");
      }
    });

    // After sign-in, honor ?next=â€¦ else go to /driver.html
    onAuthStateChanged(auth, (user) => {
      if (!user) return;
      const p = new URLSearchParams(location.search);
      const next = p.get("next") || "/driver.html";
      location.href = next;
    });
  </script>  </div>  </div>
</body></html>


